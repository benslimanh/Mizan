<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mizan Software</title>
    <link rel="icon" type="image/x-icon" href="./logo.ico" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./styles.css" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#E85D3F",           // Warm Orange (Legasi)
              background: "#FAF9F6",        // Cream/Off-white (Legasi)
              "text-main": "#1A1A1A",       // Dark Grey (Legasi)
              "brand-orange": "#E85D3F",    // Legacy support
              charcoal: "#1A1A1A",          // Legacy support
            },
            fontFamily: {
              sans: ["Inter", "ui-sans-serif", "system-ui", "sans-serif"],
            },
            boxShadow: {
              soft: "0 12px 32px rgba(26, 26, 26, 0.08)",
            },
          },
        },
      };
    </script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
      
      
const firebaseConfig = {
  apiKey: "AIzaSyCBfjUajnfrFpZaaSfYx8JAyHLs2duFMw0",
  authDomain: "mizan-auth.firebaseapp.com",
  projectId: "mizan-auth",
  storageBucket: "mizan-auth.firebasestorage.app",
  messagingSenderId: "863003198174",
  appId: "1:863003198174:web:b7215ce349318b1b03b84f",
  measurementId: "G-R5L91BGKFC"
};
      
if (window.firebase && (!firebase.apps || !firebase.apps.length)) {
        firebase.initializeApp(firebaseConfig);
      }
    </script>
  </head>

  <body class="h-full bg-background font-sans text-text-main antialiased">
    <div
      id="intro-overlay"
      class="intro-overlay fixed inset-0 z-50 flex items-center justify-center bg-background"
      aria-hidden="true"
    >
      <div class="flex flex-col items-center">
        <img src="logo.ico" alt="Mizan Logo" class="intro-logo h-24 mb-6" />
        <div class="intro-text text-xs font-semibold tracking-[0.35em] text-charcoal">
          BLOCKCHAIN-POWERED · SHARIA-COMPLIANT
        </div>
      </div>
    </div>

    <div id="loginModal" class="fixed inset-0 z-50 hidden items-center justify-center px-4" aria-hidden="true">
      <div class="absolute inset-0 bg-slate-900/30 backdrop-blur-sm"></div>
      <div class="relative w-full max-w-md rounded-3xl border border-slate-200 bg-background/80 p-6 shadow-soft backdrop-blur-md">
        <div class="flex items-start justify-between gap-4">
          <div>
            <div class="inline-flex items-center gap-2 rounded-2xl bg-slate-100 p-1 text-xs font-semibold">
              <button
                type="button"
                id="authModeLogin"
                class="rounded-xl bg-background px-3 py-2 text-charcoal shadow-sm ring-1 ring-slate-200/70"
              >
                Login
              </button>
              <button type="button" id="authModeSignup" class="rounded-xl px-3 py-2 text-slate-600 hover:text-charcoal">
                Create Account
              </button>
            </div>
            <div id="loginModalTitle" class="mt-4 text-sm font-semibold text-charcoal">Login</div>
            <div id="loginModalSubtitle" class="mt-1 text-xs text-slate-500">
              Blockchain-Powered, Sharia-Compliant (AAOIFI standards).
            </div>
          </div>
          <button
            type="button"
            id="loginModalClose"
            class="rounded-xl p-2 text-slate-500 hover:bg-background/60 hover:text-charcoal"
          >
            <i data-lucide="x" class="h-5 w-5"></i>
          </button>
        </div>

        <form id="loginForm" class="mt-6 space-y-4">
          <div>
            <label class="text-sm font-semibold text-charcoal" for="loginEmail">Email</label>
            <div class="mt-2">
              <input
                id="loginEmail"
                name="email"
                type="email"
                autocomplete="email"
                required
                class="w-full rounded-xl border border-slate-200 bg-background/70 px-4 py-3 text-sm text-charcoal shadow-sm placeholder:text-slate-400 focus:border-primary focus:outline-none focus:ring-4 focus:ring-primary/15"
                placeholder="you@company.com"
              />
            </div>
          </div>

          <div>
            <label class="text-sm font-semibold text-charcoal" for="loginPassword">Password</label>
            <div class="mt-2">
              <input
                id="loginPassword"
                name="password"
                type="password"
                autocomplete="current-password"
                required
                class="w-full rounded-xl border border-slate-200 bg-background/70 px-4 py-3 text-sm text-charcoal shadow-sm placeholder:text-slate-400 focus:border-primary focus:outline-none focus:ring-4 focus:ring-primary/15"
                placeholder="••••••••"
              />
            </div>
          </div>

          <div id="confirmPasswordRow" class="hidden">
            <label class="text-sm font-semibold text-charcoal" for="loginPasswordConfirm">Confirm Password</label>
            <div class="mt-2">
              <input
                id="loginPasswordConfirm"
                name="confirmPassword"
                type="password"
                autocomplete="new-password"
                class="w-full rounded-xl border border-slate-200 bg-background/70 px-4 py-3 text-sm text-charcoal shadow-sm placeholder:text-slate-400 focus:border-primary focus:outline-none focus:ring-4 focus:ring-primary/15"
                placeholder="••••••••"
              />
            </div>
          </div>

          <div id="loginMessage" class="text-sm font-semibold text-emerald-700" aria-live="polite"></div>
          <div id="loginError" class="text-sm font-semibold text-red-600" aria-live="polite"></div>

          <button
            type="submit"
            class="inline-flex w-full items-center justify-center gap-2 rounded-xl bg-primary px-5 py-3 text-sm font-semibold text-white shadow-sm shadow-primary/20 hover:bg-primary/95"
          >
            <i data-lucide="log-in" class="h-4 w-4"></i>
            <span id="loginSubmitText">Sign In</span>
          </button>
        </form>
      </div>
    </div>

    <div class="min-h-full">
      <header class="sticky top-4 z-40 px-4">
        <nav
          class="mx-auto flex w-full max-w-6xl items-center justify-between rounded-2xl border border-slate-200/70 bg-background/80 px-4 py-3 shadow-soft backdrop-blur-md"
        >
          <a href="./index.html" class="flex items-center gap-2">
            <img src="logo.ico" alt="Mizan Logo" class="h-8" />
            <span class="text-sm font-semibold tracking-wide text-charcoal">Mizan Software</span>
          </a>

          <div class="hidden items-center gap-7 md:flex">
            <a href="./features.html" class="text-sm font-medium text-slate-600 hover:text-charcoal"
              >Features</a
            >
            <a href="./platform.html" class="text-sm font-medium text-slate-600 hover:text-charcoal"
              >Platform</a
            >
            <a href="./contact.html" class="text-sm font-medium text-slate-600 hover:text-charcoal"
              >Contact</a
            >
          </div>

          <div class="flex items-center gap-2">
            <span id="authNotice" class="hidden text-xs font-semibold text-primary md:inline-flex"></span>
            <span id="authEmail" class="hidden text-xs font-semibold text-slate-500 md:inline-flex"></span>
            <a
              id="authButton"
              href="#login"
              class="inline-flex rounded-xl px-4 py-2 text-sm font-semibold text-charcoal hover:bg-slate-100"
              >Sign In</a
            >
            <div id="profileMenu" class="relative hidden">
              <button
                type="button"
                id="profileButton"
                class="grid h-10 w-10 place-items-center rounded-full bg-primary text-sm font-bold text-white shadow-sm shadow-primary/20"
              ></button>
              <div
                id="profileDropdown"
                class="absolute right-0 mt-3 hidden w-80 rounded-3xl border border-slate-200 bg-background/80 p-5 shadow-soft backdrop-blur-md"
              >
                <div class="text-xs font-semibold tracking-[0.22em] text-slate-400">PROFILE</div>
                <div id="profileEmail" class="mt-3 text-sm font-semibold text-charcoal"></div>
                <div id="profileSince" class="mt-1 text-xs font-semibold text-slate-500"></div>

                <div class="mt-5 flex flex-col gap-2">
                  <a
                    id="profileDashboard"
                    href="./platform.html"
                    class="inline-flex items-center justify-center gap-2 rounded-xl bg-primary px-4 py-3 text-sm font-semibold text-white shadow-sm shadow-primary/20 hover:bg-primary/95"
                  >
                    <i data-lucide="layout-dashboard" class="h-4 w-4"></i>
                    Dashboard
                  </a>
                  <button
                    type="button"
                    id="resendVerification"
                    class="hidden inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-background px-4 py-3 text-sm font-semibold text-charcoal shadow-sm hover:bg-slate-50"
                  >
                    <i data-lucide="mail" class="h-4 w-4 text-primary"></i>
                    Resend Verification
                  </button>
                  <button
                    type="button"
                    id="logoutButton"
                    class="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-background px-4 py-3 text-sm font-semibold text-charcoal shadow-sm hover:bg-slate-50"
                  >
                    <i data-lucide="log-out" class="h-4 w-4 text-primary"></i>
                    Logout
                  </button>
                </div>
              </div>
            </div>
            <a
              href="./contact.html"
              class="inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm shadow-primary/20 hover:bg-primary/95"
            >
              <i data-lucide="arrow-right" class="h-4 w-4"></i>
              Get a Demo
            </a>
          </div>
        </nav>
      </header>

      <main class="px-4">
        <section
          class="mx-auto grid max-w-6xl grid-cols-1 items-center gap-12 pb-16 pt-12 md:grid-cols-2 md:pt-16 islamic-pattern rounded-3xl px-6"
        >
          <div>
            <p
              class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-background px-4 py-2 text-xs font-semibold text-slate-600 shadow-sm"
            >
              <span class="h-2 w-2 rounded-full bg-primary"></span>
              Ethical Transparency, built for trust
            </p>

            <h1 class="mt-6 text-balance text-4xl font-bold leading-tight text-charcoal md:text-5xl">
              The Future of Islamic DeFi on Stellar.
            </h1>

            <p class="mt-5 max-w-xl text-pretty text-base leading-relaxed text-slate-500">
              Mizan Protocol automates Sharia-compliant financing using Soroban Smart Contracts. We replace complex banking intermediaries with transparent, immutable code on the Stellar Network—making Murabaha transactions instant, trustless, and interest-free.
            </p>

            <div class="mt-8 flex flex-col gap-3 sm:flex-row">
              <a
                href="https://mizan-1.gitbook.io/mizan/"
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center justify-center gap-2 rounded-xl bg-primary px-5 py-3 text-sm font-semibold text-white shadow-sm shadow-primary/20 hover:bg-primary/95"
              >
                <i data-lucide="file-text" class="h-4 w-4"></i>
                Read Whitepaper
              </a>

              <a
                href="#features"
                class="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-background px-5 py-3 text-sm font-semibold text-charcoal shadow-sm hover:bg-slate-50"
              >
                <i data-lucide="layers" class="h-4 w-4 text-primary"></i>
                Explore Features
              </a>
            </div>

            <div class="mt-10 grid grid-cols-1 gap-6 sm:grid-cols-3">
              <div>
                <div class="text-lg font-bold text-charcoal">99.9%</div>
                <div class="mt-1 text-xs font-medium text-slate-500">Uptime-ready</div>
              </div>
              <div>
                <div class="text-lg font-bold text-charcoal">SOC2</div>
                <div class="mt-1 text-xs font-medium text-slate-500">Security-first</div>
              </div>
              <div>
                <div class="text-lg font-bold text-charcoal">Fast</div>
                <div class="mt-1 text-xs font-medium text-slate-500">Time to value</div>
              </div>
            </div>
          </div>

          <div class="relative">
            <div 
              id="particle-sphere-container" 
              class="w-full h-[500px] md:h-[600px] rounded-xl overflow-hidden"
              style="box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);"
            >
              <!-- 3D Particle Sphere will be rendered here -->
            </div>
          </div>
        </section>

        <section id="features" class="mx-auto max-w-6xl pb-16 islamic-pattern rounded-3xl">
          <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
            <div>
              <h2 class="text-2xl font-bold text-charcoal">Ethical, transparent, and audit-ready</h2>
              <p class="mt-2 max-w-2xl text-sm leading-relaxed text-slate-500">
                Designed for Sharia-Compliant Transactions with an Interest-Free (Riba-Free) Ledger, Sukuk tokenization,
                and real-time Sharia auditing with On-chain AAOIFI Standards Compliance.
              </p>
            </div>
            <a
              id="platform"
              href="./platform.html"
              class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-background px-4 py-2 text-sm font-semibold text-charcoal shadow-sm hover:bg-slate-50"
            >
              <i data-lucide="sparkles" class="h-4 w-4 text-primary"></i>
              View Platform
            </a>
          </div>

          <div class="mt-8 grid grid-cols-1 gap-5 md:grid-cols-3">
            <div class="rounded-2xl border border-slate-200 bg-background p-6 shadow-sm">
              <div class="flex items-start gap-4">
                <div class="grid h-11 w-11 place-items-center rounded-xl bg-primary/10 ring-1 ring-primary/15">
                  <i data-lucide="hand-coins" class="h-5 w-5 text-primary"></i>
                </div>
                <div>
                  <h3 class="text-base font-semibold text-charcoal">Smart Contracts for Murabaha</h3>
                  <p class="mt-1 text-sm leading-relaxed text-slate-500">
                    Blockchain automates asset purchase, ownership transfer, and settlement—clear from order to delivery.
                  </p>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-background p-6 shadow-sm">
              <div class="flex items-start gap-4">
                <div class="grid h-11 w-11 place-items-center rounded-xl bg-primary/10 ring-1 ring-primary/15">
                  <i data-lucide="book-open" class="h-5 w-5 text-primary"></i>
                </div>
                <div>
                  <h3 class="text-base font-semibold text-charcoal">Immutable Ledger (Riba-Free)</h3>
                  <p class="mt-1 text-sm leading-relaxed text-slate-500">
                    Transparent, append-only records that support Ethical Finance and reduce ambiguity across transactions.
                  </p>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-background p-6 shadow-sm">
              <div class="flex items-start gap-4">
                <div class="grid h-11 w-11 place-items-center rounded-xl bg-primary/10 ring-1 ring-primary/15">
                  <i data-lucide="handshake" class="h-5 w-5 text-primary"></i>
                </div>
                <div>
                  <h3 class="text-base font-semibold text-charcoal">Musharakah Profit-Sharing</h3>
                  <p class="mt-1 text-sm leading-relaxed text-slate-500">
                    Model shared ownership and profit distribution with clear, on-chain terms and traceable approvals.
                  </p>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-background p-6 shadow-sm">
              <div class="flex items-start gap-4">
                <div class="grid h-11 w-11 place-items-center rounded-xl bg-primary/10 ring-1 ring-primary/15">
                  <i data-lucide="scan" class="h-5 w-5 text-primary"></i>
                </div>
                <div>
                  <h3 class="text-base font-semibold text-charcoal">Real-time Sharia Auditing</h3>
                  <p class="mt-1 text-sm leading-relaxed text-slate-500">
                    On-chain AAOIFI Standards Compliance with audit trails that keep decisions explainable and reviewable.
                  </p>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
              <div class="flex items-start gap-4">
                <div class="grid h-11 w-11 place-items-center rounded-xl bg-primary/10 ring-1 ring-primary/15">
                  <i data-lucide="coins" class="h-5 w-5 text-primary"></i>
                </div>
                <div>
                  <h3 class="text-base font-semibold text-charcoal">Smart Contracts for Sukuk</h3>
                  <p class="mt-1 text-sm leading-relaxed text-slate-500">
                    Fractionalize and manage Sukuk with smart contract issuance, lifecycle events, and investor reporting.
                  </p>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-background p-6 shadow-sm">
              <div class="flex items-start gap-4">
                <div class="grid h-11 w-11 place-items-center rounded-xl bg-primary/10 ring-1 ring-primary/15">
                  <i data-lucide="hand-heart" class="h-5 w-5 text-primary"></i>
                </div>
                <div>
                  <h3 class="text-base font-semibold text-charcoal">Zakat Management</h3>
                  <p class="mt-1 text-sm leading-relaxed text-slate-500">
                    Rules-led collection, allocation, and reporting aligned to Ethical Finance workflows.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="contact" class="mx-auto max-w-6xl pb-16">
          <div class="rounded-3xl border border-slate-200 bg-background px-6 py-10 shadow-soft md:px-10">
            <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
              <div>
                <h2 class="text-2xl font-bold text-charcoal">Ready to build with Mizan?</h2>
                <p class="mt-2 text-sm text-slate-500">
                  Reach out for a short discovery call and a tailored roadmap.
                </p>
              </div>
              <a
                href="./contact.html"
                class="inline-flex items-center justify-center gap-2 rounded-xl bg-primary px-5 py-3 text-sm font-semibold text-white shadow-sm shadow-primary/20 hover:bg-primary/95"
              >
                <i data-lucide="mail" class="h-4 w-4"></i>
                Contact Sales
              </a>
            </div>
          </div>
        </section>
      </main>

      <footer class="bg-slate-50">
        <div class="mx-auto max-w-6xl px-4 pb-10 pt-12">
          <div class="grid grid-cols-1 gap-10 md:grid-cols-4">
            <div class="space-y-4">
              <a href="./index.html" class="flex items-center gap-2">
                <img src="logo.ico" alt="Mizan Logo" class="h-8" />
                <span class="text-sm font-semibold tracking-wide text-charcoal">Mizan Software</span>
              </a>
              <p class="max-w-xs text-sm leading-relaxed text-slate-500">
                Blockchain-Powered, Sharia-Compliant (AAOIFI) finance on an Immutable Ledger.
              </p>
            </div>

            <div>
              <div class="text-sm font-semibold text-charcoal">Company</div>
              <ul class="mt-4 space-y-3 text-sm">
                <li><a class="text-slate-600 hover:text-charcoal" href="./about.html">About</a></li>
                <li><a class="text-slate-600 hover:text-charcoal" href="./careers.html">Careers</a></li>
                <li><a class="text-slate-600 hover:text-charcoal" href="./press.html">Press</a></li>
              </ul>
            </div>

            <div>
              <div class="text-sm font-semibold text-charcoal">Resources</div>
              <ul class="mt-4 space-y-3 text-sm">
                <li><a class="text-slate-600 hover:text-charcoal" href="./blog.html">Blog</a></li>
                <li><a class="text-slate-600 hover:text-charcoal" href="./guides.html">Guides</a></li>
                <li><a class="text-slate-600 hover:text-charcoal" href="./help.html">Help Center</a></li>
              </ul>
            </div>

            <div>
              <div class="text-sm font-semibold text-charcoal">Legal</div>
              <ul class="mt-4 space-y-3 text-sm">
                <li><a class="text-slate-600 hover:text-charcoal" href="./privacy.html">Privacy</a></li>
                <li><a class="text-slate-600 hover:text-charcoal" href="./terms.html">Terms</a></li>
                <li><a class="text-slate-600 hover:text-charcoal" href="./security.html">Security</a></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="border-t border-slate-200">
          <div class="mx-auto max-w-6xl px-4 py-6">
            <div class="text-xs text-slate-500">© 2026 Mizan Software. All rights reserved.</div>
          </div>
        </div>
      </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
    <script src="./ParticleSphere.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      window.addEventListener("load", () => {
        const overlay = document.getElementById("intro-overlay");
        const authButton = document.getElementById("authButton");
        const authNotice = document.getElementById("authNotice");
        const authEmail = document.getElementById("authEmail");
        const profileMenu = document.getElementById("profileMenu");
        const profileButton = document.getElementById("profileButton");
        const profileDropdown = document.getElementById("profileDropdown");
        const profileEmail = document.getElementById("profileEmail");
        const profileSince = document.getElementById("profileSince");
        const profileDashboard = document.getElementById("profileDashboard");
        const resendVerification = document.getElementById("resendVerification");
        const logoutButton = document.getElementById("logoutButton");
        const loginModal = document.getElementById("loginModal");
        const authModeLogin = document.getElementById("authModeLogin");
        const authModeSignup = document.getElementById("authModeSignup");
        const loginModalTitle = document.getElementById("loginModalTitle");
        const loginModalSubtitle = document.getElementById("loginModalSubtitle");
        const loginSubmitText = document.getElementById("loginSubmitText");
        const loginModalClose = document.getElementById("loginModalClose");
        const loginForm = document.getElementById("loginForm");
        const loginMessage = document.getElementById("loginMessage");
        const loginError = document.getElementById("loginError");
        const loginEmail = document.getElementById("loginEmail");
        const loginPassword = document.getElementById("loginPassword");
        const confirmPasswordRow = document.getElementById("confirmPasswordRow");
        const loginPasswordConfirm = document.getElementById("loginPasswordConfirm");

        if (window.lucide) window.lucide.createIcons();

        let authMode = "login";

        const setAuthNotice = (message) => {
          if (!authNotice) return;
          authNotice.textContent = message ?? "";
          if (message) authNotice.classList.remove("hidden");
          else authNotice.classList.add("hidden");
        };

        const formatMemberSince = (creationTime) => {
          if (!creationTime) return "";
          const date = new Date(creationTime);
          if (Number.isNaN(date.getTime())) return "";
          return date.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" });
        };

        const getEmailInitial = (email) => {
          const value = (email ?? "").trim();
          if (!value) return "U";
          return value[0].toUpperCase();
        };

        const setAuthMode = (nextMode) => {
          authMode = nextMode === "signup" ? "signup" : "login";
          if (loginMessage) loginMessage.textContent = "";
          if (loginError) loginError.textContent = "";
          if (loginModalTitle) loginModalTitle.textContent = authMode === "signup" ? "Create Account" : "Login";
          if (loginModalSubtitle) {
            loginModalSubtitle.textContent =
              authMode === "signup"
                ? "Create an account to access your dashboard."
                : "Sign in to access your dashboard.";
          }
          if (loginSubmitText) loginSubmitText.textContent = authMode === "signup" ? "Create Account" : "Sign In";
          if (loginPassword) loginPassword.setAttribute("autocomplete", authMode === "signup" ? "new-password" : "current-password");
          if (confirmPasswordRow) confirmPasswordRow.classList.toggle("hidden", authMode !== "signup");
          if (loginPasswordConfirm) {
            if (authMode === "signup") loginPasswordConfirm.setAttribute("required", "true");
            else loginPasswordConfirm.removeAttribute("required");
          }

          if (authModeLogin) {
            authModeLogin.classList.toggle("bg-background", authMode === "login");
            authModeLogin.classList.toggle("text-charcoal", authMode === "login");
            authModeLogin.classList.toggle("shadow-sm", authMode === "login");
            authModeLogin.classList.toggle("ring-1", authMode === "login");
            authModeLogin.classList.toggle("ring-slate-200/70", authMode === "login");
            authModeLogin.classList.toggle("text-slate-600", authMode !== "login");
          }

          if (authModeSignup) {
            authModeSignup.classList.toggle("bg-background", authMode === "signup");
            authModeSignup.classList.toggle("text-charcoal", authMode === "signup");
            authModeSignup.classList.toggle("shadow-sm", authMode === "signup");
            authModeSignup.classList.toggle("ring-1", authMode === "signup");
            authModeSignup.classList.toggle("ring-slate-200/70", authMode === "signup");
            authModeSignup.classList.toggle("text-slate-600", authMode !== "signup");
          }
        };

        const openLoginModal = () => {
          if (!loginModal) return;
          loginModal.classList.remove("hidden");
          loginModal.classList.add("flex");
          loginModal.setAttribute("aria-hidden", "false");
          document.documentElement.classList.add("overflow-hidden");
          if (loginMessage) loginMessage.textContent = "";
          if (loginError) loginError.textContent = "";
          if (loginEmail) loginEmail.focus();
        };

        const closeLoginModal = () => {
          if (!loginModal) return;
          loginModal.classList.add("hidden");
          loginModal.classList.remove("flex");
          loginModal.setAttribute("aria-hidden", "true");
          document.documentElement.classList.remove("overflow-hidden");
        };

        // {{ edit_1 }} Add Dashboard link protection helpers
        const dashboardLinks = Array.from(
          document.querySelectorAll('a[href$="platform.html"], a[href*="/platform.html"]')
        );

        const updateDashboardLinks = (user) => {
          const isVerified = !!(user && user.emailVerified);
          const lockedMsg = user
            ? "Verify your email to access Dashboard."
            : "Sign in to access your Dashboard.";

          dashboardLinks.forEach((link) => {
            if (isVerified) {
              // enable navigation
              link.setAttribute("href", "./platform.html");
              link.removeAttribute("aria-disabled");
              link.classList.remove("pointer-events-none", "opacity-50", "cursor-not-allowed");
              link.onclick = null;
            } else {
              // disable and intercept
              link.setAttribute("href", "#");
              link.setAttribute("aria-disabled", "true");
              link.classList.add("pointer-events-none", "opacity-50", "cursor-not-allowed");
              link.onclick = (event) => {
                event.preventDefault();
                setAuthNotice(lockedMsg);
                if (!user) openLoginModal();
              };
            }
          });
        };

        const setSignedOutUI = () => {
          if (!authButton) return;
          if (authEmail) {
            authEmail.textContent = "";
            authEmail.classList.add("hidden");
          }
          setAuthNotice("");
          if (profileMenu) profileMenu.classList.add("hidden");
          authButton.classList.remove("hidden");
          authButton.textContent = "Sign In";
          authButton.setAttribute("href", "#login");
          authButton.onclick = (event) => {
            if (!loginModal) return;
            event.preventDefault();
            openLoginModal();
          };
          // {{ edit_2 }} Lock Dashboard links when signed out
          updateDashboardLinks(null);
        };

        const setUnverifiedUI = (user) => {
          if (!authButton) return;
          if (profileMenu) profileMenu.classList.add("hidden");
          if (authEmail) {
            authEmail.textContent = user?.email ?? "";
            authEmail.classList.remove("hidden");
          }
          setAuthNotice("Verify your email to access Dashboard.");
          authButton.classList.remove("hidden");
          authButton.textContent = "Resend Verification";
          authButton.setAttribute("href", "#");
          authButton.onclick = async (event) => {
            event.preventDefault();
            if (!window.firebase || !firebase.auth) return;
            const currentUser = firebase.auth().currentUser;
            if (!currentUser) return;
            try {
              await currentUser.sendEmailVerification();
              setAuthNotice("A verification email has been sent. Please check your inbox to activate your account.");
            } catch (error) {
              setAuthNotice(error?.message ?? "Unable to resend verification email.");
            }
          };
          // {{ edit_3 }} Lock Dashboard links when unverified
          updateDashboardLinks(user);
        };

        const setVerifiedUI = (user) => {
          if (authButton) authButton.classList.add("hidden");
          if (authEmail) {
            authEmail.textContent = "";
            authEmail.classList.add("hidden");
          }
          setAuthNotice("");
          if (!profileMenu || !profileButton) return;
          profileMenu.classList.remove("hidden");
          profileButton.textContent = getEmailInitial(user?.email);
          if (profileEmail) profileEmail.textContent = user?.email ?? "";
          if (profileSince) {
            const since = formatMemberSince(user?.metadata?.creationTime);
            profileSince.textContent = since ? `Member since: ${since}` : "";
          }
          if (profileDashboard) profileDashboard.setAttribute("href", "./platform.html");
          if (resendVerification) resendVerification.classList.add("hidden");
          // {{ edit_4 }} Unlock Dashboard links when verified
          updateDashboardLinks(user);
        };

        const setSignedInUI = (user) => {
          if (!user) return setSignedOutUI();
          if (user.emailVerified) setVerifiedUI(user);
          else setUnverifiedUI(user);
        };

        const closeProfileDropdown = () => {
          if (!profileDropdown) return;
          profileDropdown.classList.add("hidden");
        };

        const openProfileDropdown = () => {
          if (!profileDropdown) return;
          profileDropdown.classList.remove("hidden");
          if (window.lucide) window.lucide.createIcons();
        };

        if (profileButton) {
          profileButton.addEventListener("click", () => {
            if (!profileDropdown) return;
            if (profileDropdown.classList.contains("hidden")) openProfileDropdown();
            else closeProfileDropdown();
          });
        }

        window.addEventListener("click", (event) => {
          if (!profileMenu || !profileDropdown || profileMenu.classList.contains("hidden")) return;
          if (!profileMenu.contains(event.target)) closeProfileDropdown();
        });

        if (authModeLogin) {
          authModeLogin.addEventListener("click", () => setAuthMode("login"));
        }

        if (authModeSignup) {
          authModeSignup.addEventListener("click", () => setAuthMode("signup"));
        }

        if (loginModalClose) {
          loginModalClose.addEventListener("click", closeLoginModal);
        }

        if (loginModal) {
          loginModal.addEventListener("click", (event) => {
            if (event.target === loginModal) closeLoginModal();
          });
          const backdrop = loginModal.querySelector("div");
          if (backdrop) {
            backdrop.addEventListener("click", closeLoginModal);
          }
          window.addEventListener("keydown", (event) => {
            if (event.key === "Escape") {
              closeLoginModal();
              closeProfileDropdown();
            }
          });
        }

        if (logoutButton) {
          logoutButton.addEventListener("click", async () => {
            if (!window.firebase || !firebase.auth) return;
            try {
              await firebase.auth().signOut();
              closeProfileDropdown();
            } catch (error) {
              setAuthNotice(error?.message ?? "Unable to sign out.");
            }
          });
        }

        if (loginForm) {
          loginForm.addEventListener("submit", async (event) => {
            event.preventDefault();
            if (!window.firebase || !firebase.auth) {
              if (loginError) loginError.textContent = "Authentication is unavailable. Please try again.";
              return;
            }
            const email = loginEmail?.value?.trim() ?? "";
            const password = loginPassword?.value ?? "";
            const confirmPassword = loginPasswordConfirm?.value ?? "";
            if (!email || !password) return;
            if (loginError) loginError.textContent = "";
            if (loginMessage) loginMessage.textContent = "";
            try {
              const auth = firebase.auth();
              if (authMode === "signup") {
                if (password !== confirmPassword) {
                  if (loginError) loginError.textContent = "Passwords do not match.";
                  return;
                }
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential?.user ?? auth.currentUser;

                if (window.firebase && firebase.firestore && user?.uid) {
                  await firebase
                    .firestore()
                    .collection("users")
                    .doc(user.uid)
                    .set(
                      {
                        email: user.email ?? email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                      },
                      { merge: true }
                    );
                }

                if (user && user.sendEmailVerification) {
                  await user.sendEmailVerification();
                  setAuthNotice("A verification email has been sent. Please check your inbox to activate your account.");
                }
              } else {
                await auth.signInWithEmailAndPassword(email, password);
              }
              closeLoginModal();
            } catch (error) {
              if (loginError) {
                loginError.textContent =
                  error?.message ?? (authMode === "signup" ? "Unable to create account." : "Unable to sign in.");
              }
            }
          });
        }

        if (window.firebase && firebase.auth) {
          firebase.auth().onAuthStateChanged((user) => {
            if (!user) return setSignedOutUI();
            Promise.resolve(user.reload?.())
              .catch(() => {})
              .finally(() => {
                const currentUser = firebase.auth().currentUser;
                setSignedInUI(currentUser ?? user);
              });
          });
        } else {
          setSignedOutUI();
        }

        if (loginModal && (window.location.hash === "#login" || window.location.hash === "#signup")) {
          setAuthMode(window.location.hash === "#signup" ? "signup" : "login");
          openLoginModal();
        } else {
          setAuthMode("login");
        }

        if (overlay) {
          document.documentElement.classList.add("overflow-hidden");

          const removeOverlay = () => {
            if (!overlay.isConnected) return;
            overlay.remove();
            if (document.getElementById("loginModal")?.classList.contains("flex")) return;
            document.documentElement.classList.remove("overflow-hidden");
          };

          window.setTimeout(() => {
            overlay.classList.add("intro-overlay--hide");
            overlay.addEventListener("transitionend", removeOverlay, { once: true });
            window.setTimeout(removeOverlay, 900);
          }, 3000);
        }
      });
    </script>
  </body>
</html>
